<section class="box hpad">
  <form class="vform">
    <label class="block">
      <div><b>Default template</b></div>
      <select ng-model="$storage.default_template_id"
        ng-options="template.id as template.name for template in templates"></select>
    </label>
    <label class="block">
      <div><b>Import blocks from file</b></div>
      <input type="file" on-upload="importFile($file)">
    </label>
  </form>
</section>

<table class="striped grid padded fill">
  <thead>
    <tr>
      <td></td>
      <td></td>
      <td>template</td>
      <td ng-repeat="parameter in experiment.parameters">
        {{parameter}}
      </td>
      <td>order</td>
      <td></td>
    </tr>
  </thead>
  <tbody checkbox-sequence>
    <tr ng-repeat="block in blocks" ng-class="{selected: block.selected}">
      <td style="padding-right: 5px">
        <input type="checkbox" ng-model="block.selected">
      </td>
      <td><a ui-sref="admin.experiments.edit.blocks.edit({block_id: block.id})">{{block.id}}</a></td>
      <td class="nowrap">
        <a ui-sref="admin.templates.edit({id: block.template_id})">
          {{templates | valueWhere:{id: block.template_id}:'name'}}
        </a>
      </td>
      <td ng-repeat="parameter in experiment.parameters">
        <span ng-bind="block.context[parameter]"></span>
      </td>
      <td>{{block.view_order}}</td>
      <td class="nowrap">
        <a href="/experiments/{{experiment.id}}/blocks/{{block.id}}?workerId=testing" target="_blank">Public</a>
        <button ng-click="deleteBlock(block, $event)">Delete</button>
      </td>
    </tr>
  </tbody>
</table>

<nav fixedflow style="bottom: 0; border-top: 1px solid #BBB; padding: 5px; background-color: #EEE;">
  <ui-view>
    <button ng-click="deleteSelectedBlocks()" class="control">Delete selection ({{(blocks | filter:{selected: true}).length}})</button>
    <a ui-sref="admin.experiments.edit.blocks.edit({block_id: 'new'})">Add empty block</a>
  </ui-view>
</nav>
